## mako

<%page expression_filter="h"/>
<%namespace name='static' file='../static_content.html'/>

<%!
import json
import six

from django.conf import settings
from django.utils.translation import ugettext as _
from django.template.defaultfilters import escapejs
from django.urls import reverse

from lms.djangoapps.discussion.django_comment_client.permissions import has_permission
from openedx.core.djangolib.js_utils import dump_js_escaped_json, js_escaped_string
from openedx.core.djangolib.markup import Text, HTML
from openedx.features.course_experience import DISABLE_UNIFIED_COURSE_TAB_FLAG, SHOW_REVIEWS_TOOL_FLAG
from openedx.features.course_experience.course_tools import HttpMethod

from lms.djangoapps.grades.course_grade import ZeroCourseGrade

from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
%>

<%block name="header_extras">
  <link rel="stylesheet" type="text/css" href="${static.url('paragon/static/paragon.min.css')}" />
  <link rel="stylesheet" type="text/css" href="${static.url('weup/css/animate-4.1.1.min.css')}" />
  <style>
    .content-wrapper {
        background-color: var(--light-gray);
        padding: unset;
    }
    header.page-header.has-secondary{
        background-color: var(--primary);
        padding-top: 10px !important;
        padding-bottom: 10px !important;
        box-shadow: 0 3px 6px rgba(0,0,0,0.16);
        display: flex;
        align-items: center;
        background-image: url("${static.url('bea-lidl/images/assets/courseware_top.png')}");
        background-size: cover;
        height: 37vw;
    }
    .page-header-secondary{
        padding: 25px 0 !important;
    }
    .search-title {
        background-color: var(--primary);
        color: white;
        text-align: center;
        width: 96%;
        padding: 12px;
        margin-left: 20px;
    }
    .wrapper-svg {
        display: flex;
        align-items: center;
    }
    .svg-location {
        fill:#709955;
        padding-left: 5px;
        height: 1.5em;
    }
    form.search-form.input-group {
        position: relative;
    }
    #search {
        border-radius: 10px;
    }
    .input-group-btn {
        height: 30px;
        position: absolute;
        left: 133px;
        z-index: 999;
    }
    .search-button {
        background-color: var(--primary);
        height: 43px;
        border-radius: 16px;
        padding: 0 15px;
        display: flex;
        align-items: center;
        border: unset;
    }
    .svg-next {
        height: 1.5em;
        fill: white;
    }
    button.search-button{
        margin-left: 5px;
        /* background: white !important; */
    }
    .global-header .header-logo .course-header, a.help-link{
        display:none !important;
    }

    .course-outline .block-tree .outline-item:nth-child(even) .outline-button .fa {
        color: var(--light-green) !important;
    }
    .course-outline .block-tree .outline-item:nth-child(odd) .outline-button .fa {
        color: var(--light-blue) !important;
    }
    .course-outline .block-tree .outline-button .complete-checkmark {
        background-color: var(--secondary);
        border-color: var(--secondary);
        color: white !important;
        padding: 2px;
    }
    .course-message .message-content .message-header{
        color: var(--secondary) !important;
    }
    .course-message .message-content{
        border: 1px solid var(--secondary) !important;
    }
    /* .section-name.accordion-trigger.outline-button    {
        padding-left: 25px !important;
        padding-right: 25px !important;
    } */
    a.subsection-text div.details,a.subsection-text span.icon.fa.fa-pencil-square-o{
        display:none !important;
    }
    .page-content .page-content-secondary{
        min-width: calc(50% - 15px);
        max-width: calc(50% - 15px);
        animation: fadeInRight;
        animation-duration: 0.5s;
        background-color: white;
        box-shadow: 0 3px 6px rgba(0,0,0,0.16);
        flex-direction: column;
        justify-content: space-between;
        padding:0;
        border-radius: 2px;
        overflow: hidden;
        margin: 0;
    }


    .page-content-container{
        border:none !important;
    }
    .global-header.global-header{
        background: white !important; 
    }
    h4.subsection-title{
        font-size: 1.25rem;
        text-align: center;
        /* width: 70%; */
        font-weight: 600 !important;
    }
    button:focus {
        outline: none !important;
    }
    .fa-chevron-right:before {
        font-size: 23px;
    }

    .small-badge {
        height: 20px;
        margin: 10px 10px 10px 0;
    }

    .main-badge{
        height:40px;
        margin: 10px 10px 10px 0;
    }

    .course-outline .block-tree .section .section-name {
        padding: 90px 65px 55px 89px;
        margin-bottom: 25px;
        color: var(--secondary)!important;
        margin-bottom: 0px !important;
        margin-top:25px !important;
        border-radius: 2px;
        display: flex;
        align-items: center;
    }
    .outline-item:nth-child(odd) > .outline-button {
        background-image: url("${static.url('bea-lidl/images/trace_bleu.png')}");
        background-repeat: no-repeat;
        background-size: 100% 100%;
    }
    .outline-item:nth-child(even) > .outline-button {
        background-image: url("${static.url('bea-lidl/images/trace_vert.png')}");
        background-repeat: no-repeat;
        background-size: 100% 100%;
    }
    .outline-item > .accordion-panel {
        background-image: url("${static.url('bea-lidl/images/trace_blanc.png')}");
        background-repeat: no-repeat;
        background-size: 100% 100%;
    }
    

    .page-content-secondary {
        margin-top:25px !important;
    }
    #expand-collapse-outline-all-button {
        display: none;
    }

    .page-content {
        padding: 20px 90px;
        background-color: var(--light-gray);
    }

    #main{
    	animation: fadeInLeft;
        animation-duration: 0.5s;
        background-color: var(--light-gray) !important;
    }
    /* .wrapper-preview-menu{
       //display:none;
    } */
    .wrapper-preview-menu .view-in-studio, .wrapper-preview-menu a.btn.btn-primary{
        display:none !important;
    }


    .section-title{
       color:white !important;
       flex: 1;
       font-size: 1.8rem !important;
       font-weight: 600 !important;
    }
    h2.hd.hd-3.page-title{
       color:white !important;
    }
    .window-wrap, #course-container,#course-outline-block-tree{
       background: var(--light-gray);
    }
    #main, .outline-item.accordion-panel{
       display: flex;
       justify-content: center;
       flex-wrap: wrap;
       padding: 0 0 80px 0 !important;
    }
    .accordion {
        border: unset !important;
        margin: 0 35px !important;
    }
    .accordion-panel .accordion .outline-button {
        display: flex !important;
        flex-direction: column;
        align-items: center;
        justify-content: space-evenly;
        height: 360px;
        width: 18vw !important;
    }
    .outline-button > img {
        width: 200px;
    }

/* 
    .course-outline .block-tree .section {
        margin: 0 !important;
        clip-path: polygon(0% 35%, 3% 6%, 5% 4%, 9% 3%, 89% 2%,96% 3%,99% 6%, 100% 9%, 100% 32%, 98% 91%, 97% 95%, 94% 97%, 82% 99%, 58% 99%, 16% 98%, 7% 97%, 4% 96%, 1% 92%);
    } 
*/


    .grade-block {
        display: flex;
        flex-direction: column;
        position: relative;
    }
    .progress_bar_and_score {
        display: flex;
        align-items: center;
    }

    .progress-bar-full {
        width: 19vw;
        background-color: white;
        position: relative;
        /* margin-bottom: 20px; */
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        height: 20px;
        overflow: hidden;
        border-radius: 20px;
        padding: 3px;
    }

    .progress-bar-grade {
        position: absolute;
        /* top:0; */
        left: 3px;
        background-color:var(--light-blue);
        height: 72%;
        border-radius: 20px;
        animation: fadeInLeft;
        animation-duration: 1.5s;
    }
    .completed_percent {
        width : 100px;
        text-align: center;
        color: white !important;
        margin-bottom: 0 !important;
    }

    .grade-value {
        font-weight: 500;
        position: absolute;
        right: 0;
    }

    #final-grade-progress {
        height: 15px;
        border-radius: 7.5px;
    }

    #final-grade-progress .progress-bar-grade{
        background-color: var(--primary);
        border-radius: 7.5px;
    }

    .grade-section-title {
        display: flex;
        flex-direction: row;
        align-items: center;
        font-weight: 500;
        position: relative;
    }

    #share-list {
        display: flex;
        list-style: none;
        flex-direction: row;
        flex-direction: row;
        justify-content: center;
        border-top:1px solid rgba(0, 0, 0, 0.2);
        padding-top: 30px;
        padding-left: 0;
        margin: 0 25px 25px 25px;
    }

    #share-list i {
        font-size: 40px;
        margin: 0 10px;
        color: #343a40;
    }

    #badges {
        padding: 0 25px 25px 25px;
    }

    .page-content .page-content-secondary h4{
        padding:15px;
        color:white;
        background-color:var(--tertiary);
        text-align:center
    }

    .grade-section-title .chapter-title{
        max-width: 80%;
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow: hidden;
    }

    #logo_banner {
        margin: auto 30px;
        height: 106px;
    }

    
    @media screen and (max-width: 1024px) {
        .page-content .page-content-secondary { 
            min-width: calc(50% - 15px);
            max-width: calc(50% - 15px);
            margin: 0;
        }
    }
    @media screen and (max-width: 991px) {
        .page-content .page-content-secondary { 
            min-width: calc(60% - 15px);
            max-width: calc(60% - 15px);
        }

    }
    @media screen and (max-width: 768px) {
        .page-content .page-content-secondary { 
            min-width: 100%;
            max-width: 100%;
            margin-left: 0;
        }

        .page-content {
            flex-direction: column;
        }

        .page-content .page-content-secondary h4{
            font-size:16px;
        }
    }

    @media screen and (max-width: 500px) {
        .grade-section-title {
            font-size: 12px;
        }

        .main-badge{
            height:25px;
        }

        .small-badge {
            margin: 0 5px 5px 5px;
        }
        h3.section-title{
            padding-left: 5px !important;
            font-size: 14px !important;
        }
        h4.subsection-title{
            font-size: 14px !important;
        }
    }

    @media screen and (max-width: 500px) {
        .grade-section-title {
            font-size: 14px;
        }
    }

  </style>
  <script>
document.title = "Cours | ${HTML(course.display_name_with_default)}";
  </script>

</%block>


<%block name="content">
<div class="course-view page-content-container" id="course-container">

    <header class="page-header has-secondary">
        <div class="page-header-main">
            <!-- <img id="logo_banner" src="${static.url('{}/images/logo_secondary.png'.format(course.org))}" alt="banner logo"> -->
        </div>
        <div class="vertical-align">
            <div class="search-title" >
                Recherchez une ressource par mots-clés
            </div>
            <div class="page-header-secondary">
                <div class="page-header-search">
                    <form class="search-form input-group" role="search" action="${reverse('openedx.course_search.course_search_results', args=[course_key])}">
                        <label class="field-label sr-only" for="search" id="search-hint">${_('Search the course')}</label>
                        <input
                        class="field-input input-text search-input form-control"
                        type="search"
                        name="query"
                        id="search"
                        placeholder="${_('Search the course')}"
                        />
                        <span class="input-group-btn">
                            <button class="btn btn-outline-primary search-button" type="submit">
                                <svg xmlns="http://www.w3.org/2000/svg" class="svg-next" height="1em" viewBox="0 0 320 512"><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>                                
                            </button>
                        </span>
                    </form>
                </div>
                <div class="form-actions">
                    % if resume_course_url:
                    <a class="btn btn-secondary action-resume-course" href="${resume_course_url}">
                        % if has_visited_course:
                        <span data-action-type="resume" class="wrapper-svg" >Reprendre où j'en étais 
                            <svg class="svg-location" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
                        </span>
                        % else:
                        <span data-action-type="start" class="wrapper-svg">${_("Start Course")}
                            <svg class="svg-location" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M215.7 499.2C267 435 384 279.4 384 192C384 86 298 0 192 0S0 86 0 192c0 87.4 117 243 168.3 307.2c12.3 15.3 35.1 15.3 47.4 0zM192 128a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/></svg>
                        </span>
                        % endif
                    </a>
                    % endif
                </div>
            </div>

        </div>
    </header>



    <div class="page-content">
        <div class="page-content-main">
            % if offer_banner_fragment:
                ${HTML(offer_banner_fragment.content)}
            % endif
            % if course_expiration_fragment:
                ${HTML(course_expiration_fragment.content)}
            % endif
            % if course_home_message_fragment:
                ${HTML(course_home_message_fragment.body_html())}
            % endif

            % if update_message_fragment and not DISABLE_UNIFIED_COURSE_TAB_FLAG.is_enabled(course.id):
                <div class="section section-update-message">
                    ${HTML(update_message_fragment.body_html())}
                </div>
            % endif

            % if outline_fragment:
                ${HTML(outline_fragment.body_html())}
            % endif
        </div>
    </div>
    % if course_sock_fragment:
        ${HTML(course_sock_fragment.body_html())}
    % endif
</div>
</%block>

<%static:webpack entry="CourseHome">
    new CourseHome({
        courseRunKey: "${course_key | n, js_escaped_string}",
        resumeCourseLink: ".action-resume-course",
        courseToolLink: ".course-tool-link",
        goalApiUrl: "${goal_api_url | n, js_escaped_string}",
        username: "${username | n, js_escaped_string}",
        courseId: "${course.id | n, js_escaped_string}",
    });
</%static:webpack>

<%static:webpack entry="Enrollment">
    new CourseEnrollment('.enroll-btn', '${course_key | n, js_escaped_string}');
</%static:webpack>

<%static:require_module_async module_name="js/commerce/track_ecommerce_events" class_name="TrackECommerceEvents">

  var personalizedLearnerSchedulesLink = $(".personalized_learner_schedules_button");
  var fbeLink = $("#FBE_banner");
  var welcomeLink = $("#welcome");
  var sockLink = $("#sock");
  var upgradeDateLink = $("#course_home_dates");
  var GreenUpgradeLink = $("#green_upgrade");
  var courseToolsUpgradeLink = $(document.querySelectorAll("[data-analytics-id='edx.tool.verified_upgrade']"));
  var GreenUpgradeLink = $("#green_upgrade");
  var certificateUpsellLink = $("#certificate_upsell");

    TrackECommerceEvents.trackUpsellClick(personalizedLearnerSchedulesLink, 'course_home_upgrade_shift_dates', {
      pageName: "course_home",
      linkType: "button",
      linkCategory: "personalized_learner_schedules"
    });

    TrackECommerceEvents.trackUpsellClick(fbeLink, 'course_home_audit_access_expires', {
      pageName: "course_home",
      linkType: "link",
      linkCategory: "FBE_banner"
    });

    TrackECommerceEvents.trackUpsellClick(welcomeLink, 'course_home_welcome', {
      pageName: "course_home",
      linkType: "link",
      linkCategory: "welcome"
    });

    TrackECommerceEvents.trackUpsellClick(sockLink, 'course_home_sock', {
      pageName: "course_home",
      linkType: "button",
      linkCategory: "green_upgrade"
    });

    TrackECommerceEvents.trackUpsellClick(upgradeDateLink, 'course_home_dates', {
      pageName: "course_home",
      linkType: "link",
      linkCategory: "(none)"
    });

    TrackECommerceEvents.trackUpsellClick(GreenUpgradeLink, 'course_home_green', {
      pageName: "course_home",
      linkType: "button",
      linkCategory: "green_upgrade"
    });

    TrackECommerceEvents.trackUpsellClick(courseToolsUpgradeLink, 'course_home_course_tools', {
      pageName: "course_home",
      linkType: "link",
      linkCategory: "(none)"
    });

    TrackECommerceEvents.trackUpsellClick(certificateUpsellLink, 'course_home_certificate', {
        pageName: "course_home",
        linkType: "link",
        linkCategory: "(none)"
      });

</%static:require_module_async> 
