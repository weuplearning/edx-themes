<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
import six
import waffle

from django.conf import settings
from django.urls import reverse
from django.utils.translation import ugettext as _

from lms.djangoapps.edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.js_utils import js_escaped_string
from openedx.core.djangolib.markup import HTML
from openedx.features.course_experience import course_home_page_title, DISABLE_COURSE_OUTLINE_PAGE_FLAG
%>
<%
   include_special_exams = (
   request.user.is_authenticated and
   settings.FEATURES.get('ENABLE_SPECIAL_EXAMS', False) and
   (course.enable_proctored_exams or course.enable_timed_exams)
   )
%>

<style>

.wrapper-course-material{
  display: none !important;
}


.responsive_menu{
  display: none;
}

.responsive_accordion{
  display: none;
}

  .page-header{
    width: 80%;
    margin: auto;
    padding-left: 0;
  }

  .page-header,
  .container>div {
    border: none;
  }


  .window-wrap {
    background: url("${static.url('{}/images/bg_img.png'.format(course.org))}");
    background-size: contain;
  }
  body.view-in-course .container {
    width: 100%;
    display: flex;
    max-width: inherit;
}

.button-chapter-strong {
        background-color: rgb(0,91,144) !important;
        background-image: none !important;
        display: block;
        height: 50px;
        margin-bottom: 5px;
        display: flex;
  align-items: center;
    }

    .group-heading-strong{
        color:#fff;
        width: 100%;
      text-align: center !important;
      font-size: 18px;
      font-weight: bold !important;
    }

    .accordion{
      height: 100vh;
    overflow: scroll;
    scrollbar-color: #005b90 #e0e0e0;
    }

    .accordion::-webkit-scrollbar {

  background-color: #e0e0e0; /* or add it to the track */
}
/* Add a thumb */
.accordion::-webkit-scrollbar-thumb {
    background: #005b90;
}

    .sequence-bottom,
    .unit-title,
    .bookmark-button-wrapper,
    .course-tabs
    .amazonfreetextcomment,
    .page-header
    {
      display: none !important;
    }

    .course-content{
      width: 72% !important;
    }




/* admin menu right */

.admin-menu{
  min-width: 15%;
}

.admin-menu__list{
  list-style: none;
  display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: flex-start;
}
.admin-menu__list--element{
  margin-bottom: 1.2em;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-left: 15px;
  margin-right: 15px;
margin-top: 5px;
}

.admin-menu__list--button_text{
  font-weight: bold;
}

.admin-menu__list--element_text{
  text-transform: uppercase;
  color: rgb(0,91,144);
  font-weight: bold;
  font-size: 1.9em;
  padding-bottom: 5px;
}

.admin-menu__list--element_text:hover{
  border-bottom: 1px solid rgb(0,91,144);
}

.admin-menu--img{
  width: 40px;
  margin-right: 10px;
}

.admin-menu__list--button_div{
  display: flex;
  align-items: center;
  color: #fff;
  width: 160px;
  padding: 10px;
  margin-bottom: 1.2em;
  margin-left: 15px;
}

.admin-menu__list--button_div{
  width: 160px;
  margin-bottom: 1.2em;
}

.button_admin{
  background-color: rgb(0,91,144);
}

.button_user{
  background-color: rgb(52,128,195);
  cursor: pointer;
}

.admin-menu--img_user{
  width: 25px;
  margin-right: 10px;
}

.how_it_works {
    width: 37px !important;
    margin-right: 10px !important;
    margin-left: -4px !important;
}


.user_menu{
  border: 1px solid black;
  padding: 10px;
  margin-top: -15px;
  padding-right: 47px;
  padding-top: 16px;
  margin-left: 15px;
  position: absolute;
  z-index: 10;
  background: white 
}

.dropdown-nav-item{
  margin-bottom: 10px;
}

.header_admin-menu--container{
  display: flex;
  justify-content: space-between;

}

.header_admin-menu{
  display: flex;
  justify-content: center;
  align-items: flex-end;
}

@media screen and (max-width: 1113px) {
  .list-element-left {
  width: 263px;
  }
}

@media screen and (max-width: 865px) {
  .admin-menu__list--element_text{
    font-size: 1.4em;
  }

  .list-element-left {
    width: 215px;
}
}

@media screen and (max-width: 768px) {
  .header_admin-menu--container {
  display: none;
  }
  .responsive_menu{
  display: block;
  float: right;
  cursor: pointer;
  margin-right: 1em;
}

.header_admin-menu{
  flex-direction: column;
  align-items: center;
}
.admin-menu-left{
  margin-left: 51px;
}
.list-element-left{
  width: inherit;
}

.course-index{
    display: none;
    z-index: 10;
    position: absolute;
  }

  .responsive_accordion{
  display: block;
  cursor: pointer;
  margin-left: 1em;
}
}

/* @media screen and (max-width: 600px) {
  .course-index{
    display: none;
    z-index: 10;
    position: absolute;
  }

  .responsive_accordion{
  display: block;
  cursor: pointer;
  margin-left: 1em;
}
} */

.openedxscorm_block{
  margin: auto;
  width: 88%;
}
.js-button-full-screen{
  background: #005b90;
    color: #fff;
    box-shadow: none;
    text-shadow: none;
    border: none;

}

.sequence-nav{
 top: 450px;
}

#couleur-fond-cours{
  width: 88%;
  margin: auto;
}

</style>

<!-- style for X menu -->
<style>
  .containerBAr {
    display: inline-block;
    cursor: pointer;
  }
  
  .bar1, .bar2, .bar3 {
    width: 35px;
    height: 5px;
    background-color: #333;
    margin: 6px 0;
    transition: 0.4s;
  }
  
  .change .bar1 {
    -webkit-transform: rotate(-45deg) translate(-9px, 6px);
    transform: rotate(-45deg) translate(-9px, 6px);
  }
  
  .change .bar2 {opacity: 0;}
  
  .change .bar3 {
    -webkit-transform: rotate(45deg) translate(-8px, -8px);
    transform: rotate(45deg) translate(-8px, -8px);
  }
  </style>

  

% if display_reset_dates_banner:
    <script type="text/javascript">
        $('.reset-deadlines-banner').css('display', 'flex');
    </script>
% endif
<%def name="course_name()">
 <% return _("{course_number} Courseware").format(course_number=course.display_number_with_default) %>
</%def>

<%block name="bodyclass">view-in-course view-courseware courseware ${course.css_class or ''}</%block>

<%block name="title">
<title data-base-title="${static.get_page_title_breadcrumbs(section_title, course_name())}">
  ${static.get_page_title_breadcrumbs(sequence_title, section_title, course_name())}
</title>
</%block>

<%block name="header_extras">

% for template_name in ["image-modal"]:
<script type="text/template" id="${template_name}-tpl">
    <%static:include path="common/templates/${template_name}.underscore" />
</script>
% endfor

% if include_special_exams is not UNDEFINED and include_special_exams:
  % for template_name in ["proctored-exam-status"]:
    <script type="text/template" id="${template_name}-tpl">
        <%static:include path="courseware/${template_name}.underscore" />
    </script>
  % endfor
% endif

</%block>

<%block name="headextra">
<%static:css group='style-course-vendor'/>
<%static:css group='style-course'/>
## Utility: Notes
% if is_edxnotes_enabled(course, request.user):
<%static:css group='style-student-notes'/>
% endif

<script type="text/javascript" src="${static.url('js/jquery.autocomplete.js')}"></script>
<script type="text/javascript" src="${static.url('js/src/tooltip_manager.js')}"></script>

<link href="${static.url('css/vendor/jquery.autocomplete.css')}" rel="stylesheet" type="text/css">
  ${HTML(fragment.head_html())}
</%block>

<%block name="js_extra">
  <script type="text/javascript" src="${static.url('common/js/vendor/jquery.scrollTo.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.js')}"></script>

  <%static:js group='courseware'/>
  <%include file="/mathjax_include.html" args="disable_fast_preview=True"/>

  % if show_search:
    <%static:require_module module_name="course_search/js/course_search_factory" class_name="CourseSearchFactory">
        var courseId = $('.courseware-results').data('courseId');
        CourseSearchFactory({
            courseId: courseId,
            searchHeader: $('.search-bar')
        });
    </%static:require_module>
  % endif

  <%static:require_module module_name="js/courseware/courseware_factory" class_name="CoursewareFactory">
    CoursewareFactory();
  </%static:require_module>

  % if staff_access:
  	<%include file="xqa_interface.html"/>
  % endif

  <script type="text/javascript">
    var $$course_id = "${course.id | n, js_escaped_string}";
  </script>

  % if not request.user.is_authenticated:
      <script type="text/javascript">
        // Disable discussions
        $('.xblock-student_view-discussion button.discussion-show').attr('disabled', true);

        // Insert message informing user discussions are only available to logged in users.
        $('.discussion-module')
      </script>
  % endif

${HTML(fragment.foot_html())}

</%block>

<div class="message-banner" aria-live="polite"></div>

% if default_tab:
  <%include file="/courseware/course_navigation.html" />
% else:
  <%include file="/courseware/course_navigation.html" args="active_page='courseware'" />
% endif


<div id="responsive_menu" class="containerBar responsive_menu" onclick="myFunction(this)">
  <div class="bar1"></div>
  <div class="bar2"></div>
  <div class="bar3"></div>
</div>

<div id="responsive_accordion" class="containerBar responsive_accordion" onclick="myFunction(this)">
  <div class="bar1"></div>
  <div class="bar2"></div>
  <div class="bar3"></div>
</div>

<!-- <div id="responsive_menu" class="responsive_menu">
  click header
</div> -->
<!-- <div id="responsive_accordion" class="responsive_accordion">
  click navigation
</div> -->
<header id="header_admin-menu--container" class="header_admin-menu--container">
  <div class="header_admin-menu" style="width: 18%;">
  </div>
  <div class="header_admin-menu admin-menu-left">
    <a href="/courses/course-v1:bim+FR+2021/b21982c4a63e4667905f15529c7375c6/">
      <div class="admin-menu__list--element">
        <img style="width: 40px;" class="admin-menu--img" src="${static.url('bim/images/picto-boite-a-outils.svg')}" alt="logo boite à outils" id="toolbox-logo"/>
        <p class="admin-menu__list--element_text list-element-left">Boite à outils</p>
      </div>
    </a>
    <!-- <a href="https://bim.koa.qualif.dev/courses/course-v1:bim+test+test/discussion/forum/"> -->
      <a href="/courses/course-v1:bim+FR+2021/discussion/forum/">
      <div class="admin-menu__list--element">
        <img style="width: 40px;" class="admin-menu--img" src="${static.url('bim/images/picto-forum.svg')}" alt="logo boite à outils" id="toolbox-logo"/>
        <p class="admin-menu__list--element_text">Forum</p>
      </div>
    </a>
  </div>
  <div class="header_admin-menu">
  %if staff_access:
    <a href="/wul_apps/dashboard/home">
      <div>
        <div class="admin-menu__list--button_div button_admin " >
          <img class="admin-menu--img_user" src="${static.url('bim/images/head.png')}" alt="logo admin" id="toolbox-logo"/>
          <p class="admin-menu__list--button_text">Espace administrateur</p>
        </div>
      </div>
    </a>
  %endif
  <div>
      <div id="user_menu_button" class="admin-menu__list--button_div button_user" >
        <img class="admin-menu--img_user" src="${static.url('bim/images/head.png')}" alt="logo utilisateur" id="toolbox-logo"/>
        <p class="admin-menu__list--button_text">Espace utilisateur</p>
      </div>
      <div id="user_menu_items" class="user_menu" style="display: none;" >
        <!-- <div class="mobile-nav-item dropdown-item dropdown-nav-item"><a href="${reverse('dashboard')}" role="menuitem">${_("Dashboard")}</a></div> <hr> -->
        <div class="mobile-nav-item dropdown-item dropdown-nav-item"><a href="${reverse('account_settings')}" role="menuitem">Mon compte</a></div> <hr>
        <div class="mobile-nav-item dropdown-item dropdown-nav-item"><a href="${reverse('logout')}" role="menuitem">${_("Sign Out")}</a></div>
      </div>
    </div>
  </div>
</header>
<div class="container"
  % if getattr(course, 'language'):
    lang="${course.language}"
  % endif
  >
  <div class="course-wrapper" role="presentation">

% if disable_accordion is UNDEFINED or not disable_accordion:
    <div class="course-index" id="course-index">
          <!-- <a href="https://bim.koa.qualif.dev/courses/course-v1:bim+test+test/c35c81be41c34ad3814a6ffae7515b0f/" role="button" id="comment-ça-marche-parent" aria-controls="comment-ça-marche-child" aria-expanded="true" class="button-chapter button-chapter-strong chapter"> -->
            <a href="/courses/course-v1:bim+FR+2021/638ecffb4afd43c8bfd73fa3746b1eb9/"  class="button-chapter-strong chapter">
              <span class="group-heading-strong">
                  Comment ça marche ?
              </span>
              <a href="/courses/course-v1:bim+FR+2021/5d2904880c73474e89a98224aa4bff87/" role="button" id="cahier-charge-parent" aria-controls="cahier-charge-child" aria-expanded="true" class="button-chapter-strong chapter">
                <span class="group-heading group-heading-strong active" aria-label="cahier-charge">
                    <!-- <span class="icon fa fa-caret-down" aria-hidden="true"></span> -->
                    Le cahier des charges BIM
                </span>
            </a>
      <div class="accordion">
        <nav class="course-navigation" aria-label="${_('Course')}">

          % if accordion.strip():
            ${HTML(accordion)}
          % else:
            <div class="chapter">${_("No content has been added to this course")}</div>
          % endif

        </nav>
      </div>
      <a href="/courses/course-v1:bim+FR+2021/f480cb37c0964a4e9688ff964c007403/" role="button" id="procedure-commande-parent" aria-controls="procedure-commande-child" aria-expanded="true" class="button-chapter-strong chapter">
        <span class="group-heading group-heading-strong active" aria-label="procedure-commande">
            <!-- <span class="icon fa fa-caret-down" aria-hidden="true"></span> -->
            Procédure de commande
        </span>
      </a>
      <a href="/courses/course-v1:bim+FR+2021/3625c869a38c40aa8ebb7f2bb341dc2f/" role="button" id="cloture-accompagnement-parent" aria-controls="cloture-accompagnement-child" aria-expanded="true" class="button-chapter-strong chapter">
        <span class="group-heading group-heading-strong active" aria-label="cloture-accompagnement">
            <!-- <span class="icon fa fa-caret-down" aria-hidden="true"></span> -->
            Clôture de l'accompagnement
        </span>
      </a>
    </div>
% endif
    <section class="course-content" id="course-content">

        <main id="main" tabindex="-1" aria-label="Content">
            % if getattr(course, 'entrance_exam_enabled') and \
               getattr(course, 'entrance_exam_minimum_score_pct') and \
               entrance_exam_current_score is not UNDEFINED:
                % if not entrance_exam_passed:
                <p class="sequential-status-message">
                    ${_('To access course materials, you must score {required_score}% or higher on this \
                    exam. Your current score is {current_score}%.').format(
                        required_score=int(round(course.entrance_exam_minimum_score_pct * 100)),
                        current_score=int(round(entrance_exam_current_score * 100))
                    )}
                </p>
                <script type="text/javascript">
                $(document).ajaxSuccess(function(event, xhr, settings) {
                    if (settings.url.indexOf("xmodule_handler/problem_check") > -1) {
                        var data = JSON.parse(xhr.responseText);
                        if (data.entrance_exam_passed){
                            location.reload();
                        }
                    }
                });
                </script>
                % else:
                  <p class="sequential-status-message">
                    ${_('Your score is {current_score}%. You have passed the entrance exam.').format(
                        current_score=int(round(entrance_exam_current_score * 100))
                    )}
                </p>
                % endif
            % endif
              ${HTML(fragment.body_html())}
        </main>
    </section>



    <section class="courseware-results-wrapper">
      <div id="loading-message" aria-live="polite" aria-relevant="all"></div>
      <div id="error-message" aria-live="polite"></div>
      <div class="courseware-results search-results" data-course-id="${course.id}" data-lang-code="${language_preference}"></div>
    </section>

  </div>


  ${HTML(course_sock_fragment.body_html())}
</div>
<div class="container-footer">
  % if settings.FEATURES.get("LICENSING", False):
    <div class="course-license">
    % if getattr(course, "license", None):
      <%include file="../license.html" args="license=course.license" />
    % else:
      ## Default course license: All Rights Reserved, if none is explicitly set.
      <%include file="../license.html" args="license='all-rights-reserved'" />
    % endif
    </div>
  % endif
</div>
% if course.show_calculator or is_edxnotes_enabled(course, request.user):
    <nav class="nav-utilities ${"has-utility-calculator" if course.show_calculator else ""}" aria-label="${_('Course Utilities')}">
      ## Utility: Notes
      % if is_edxnotes_enabled(course, request.user):
        <%include file="/edxnotes/toggle_notes.html" args="course=course"/>
      % endif

      ## Utility: Calc
      % if course.show_calculator:
        <%include file="/calculator/toggle_calculator.html" />
      % endif
    </nav>
% endif

<%static:require_module_async module_name="js/commerce/track_ecommerce_events" class_name="TrackECommerceEvents">

  var fbeLink = $("#FBE_banner");
  var welcomeLink = $("#welcome");
  var accessDeniedUpsellLink = $("#accessDeniedUpsell");
  var sockLink = $("#sock");

  TrackECommerceEvents.trackUpsellClick(fbeLink, 'in_course_audit_access_expires', {
      pageName: "in_course",
      linkType: "link",
      linkCategory: "FBE_banner"
  });

  TrackECommerceEvents.trackUpsellClick(welcomeLink, 'in_course_welcome', {
      pageName: "in_course",
      linkType: "link",
      linkCategory: "welcome"
  });

  TrackECommerceEvents.trackUpsellClick(accessDeniedUpsellLink, 'in_course_upgrade', {
    pageName: "in_course",
    linkType: "link",
    linkCategory: "(none)"
  });

  TrackECommerceEvents.trackUpsellClick(sockLink, 'in_course_sock', {
      pageName: "in_course",
      linkType: "button",
      linkCategory: "green_upgrade"
  });

</%static:require_module_async>

<script>

  function toggleMenu (elementToDisplay) {
    let menu = document.getElementById(elementToDisplay);
    if (menu.style.display === "none" || !menu.style.display) {
      menu.style.display = "block";
    } else {
      menu.style.display = "none";
    }
  }

  function addClickEvent(parent, elementToDisplay) {
    document.getElementById(parent).addEventListener("click", () => {toggleMenu(elementToDisplay)})
  }

  addClickEvent("user_menu_button", "user_menu_items")
  addClickEvent("responsive_menu", "header_admin-menu--container")
  addClickEvent("responsive_accordion", "course-index")
  
  function myFunction(x) {
  x.classList.toggle("change");


  function adaptDisplayToSize () {
    let windowSize = screen.width;
    let accordion = document.getElementById("course-index");
    let menu = document.getElementById("header_admin-menu--container");

    if (windowSize > 768) {
      if (accordion.style.display === "none") {
        accordion.style.display = "block";
      }
      if (menu.style.display === "none") {
        menu.style.display = "flex";
      }
    } 
  }

  window.addEventListener('resize', adaptDisplayToSize);
}
</script>

<script>
  $('#amazonfreetextcomment').hide()
  $('.wrapper-course-material').hide()

  let fullScreenButton = document.getElementsByClassName("full-screen-on")
  // let fullScreenOffButton = document.getElementsByClassName("full-screen-on")

  var checkExist = setInterval(function() {
   if (fullScreenButton.length) {
      fullScreenButton[0].textContent="Plein écran";
      clearInterval(checkExist);
   }
}, 50);

// let checkfullScreenExist = setInterval(function() {
//    if (fullScreenOffButton.length) {
//       fullScreenOffButton[0].textContent="Quitter le plein écran";
//       clearInterval(checkExist);
//    }
// }, 50);

// fullScreenButton[0].addEventListener("click", checkfullScreenExist)
// fullScreenOffButton[0].addEventListener("click", checkExist)


</script>
